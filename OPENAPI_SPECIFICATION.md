# OpenAPI Specification Management

This document explains how OpenAPI specifications are managed in the LangPlug project to maintain a single source of truth.

## File Structure

```
LangPlug/
├── openapi_spec.json          # ✅ CANONICAL - Single source of truth
├── Frontend/
│   ├── openapi-ts.config.ts   # ✅ References canonical spec
│   └── src/client/           # Generated TypeScript client
└── Backend/
    ├── core/app.py           # FastAPI app that generates the spec
    └── export_openapi.py     # Utility to export spec manually
```

## Single Source of Truth

- **Canonical Location**: `/openapi_spec.json` (root level)
- **Generated By**: FastAPI application in `Backend/core/app.py`
- **Used By**: Frontend TypeScript client generation

## Generation Process

### Automatic Generation (Recommended)

```bash
# Use the unified cross-platform script
python scripts/generate_typescript_client.py
```

This script:
1. Exports OpenAPI spec from running FastAPI backend
2. Saves to canonical location (`/openapi_spec.json`)
3. Generates TypeScript client in `Frontend/src/client/`

### Manual Generation (if needed)

```bash
# Export OpenAPI spec manually
cd Backend
python export_openapi.py

# Generate TypeScript client manually
cd Frontend
npm run generate-client
```

## Client Configuration

The TypeScript client generation is configured in `Frontend/openapi-ts.config.ts`:

```typescript
export default defineConfig({
  client: 'axios',
  input: '../openapi_spec.json',  // References canonical spec
  output: './src/client',
});
```

## Best Practices

### ✅ DO:
- Always use the canonical `/openapi_spec.json` file
- Use the unified generation script for consistency
- Regenerate client after API changes
- Version control the generated TypeScript client

### ❌ DON'T:
- Create duplicate OpenAPI specification files
- Manually edit the generated OpenAPI spec
- Reference non-canonical OpenAPI files
- Commit temporary or machine-specific OpenAPI files

## Troubleshooting

### Missing OpenAPI Spec
If the canonical file is missing, regenerate it:
```bash
python scripts/generate_typescript_client.py
```

### Outdated TypeScript Client
If API changes aren't reflected in the frontend:
```bash
# Regenerate client
python scripts/generate_typescript_client.py

# Or just the client part
cd Frontend && npm run generate-client
```

### Inconsistent API Behavior
If the frontend client doesn't match backend behavior:
1. Ensure the backend server is running
2. Regenerate the OpenAPI spec
3. Check for uncommitted API changes

## Historical Context

Previously, the project had multiple confusing OpenAPI files:
- `current_openapi.json` (removed - was duplicate/outdated)
- `Backend/openapi_spec.json` (removed - wrong location)

This consolidation ensures clarity and prevents confusion about which specification is authoritative.
